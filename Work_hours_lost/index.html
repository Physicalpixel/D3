<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<style>
    .state-borders {
        fill: none;
        stroke: rgb(73, 73, 73);
        stroke-width: 0.7px;
        stroke-linejoin: round;
        stroke-linecap: round;
        pointer-events: none;
    }
    
    polygon {
        fill: CadetBlue
    }
</style>

<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script>
    var svg = d3.select("body").select("svg")

    Promise.all([
            d3.json("https://d3js.org/us-10m.v1.json"),
            d3.csv("https://raw.githubusercontent.com/Physicalpixel/D3/main/Work_hours_lost/extreme1.csv")
        ])
        .then(showData)

    function showData([data, temp]) {

        var projection = d3.geoMercator()
        projection.center([-96, 40])
            .scale(950)

        var path1 = d3.geoPath()
            .projection(projection);
        var path = d3.geoPath()



        svg.append("g")
            .attr("class", "states")
            .selectAll("path")
            .data(topojson.feature(data, data.objects.states).features)
            .enter().append("path")
            .attr("d", d => path(d))
            .attr("fill", "grey")
            .style("opacity", 0.5)

        svg.append("path")
            .attr("class", "state-borders")
            .attr("d", path(topojson.mesh(data, data.objects.states, function(a, b) {
                return a !== b;
            })));


        let year_keys = d3.map(temp, d => d.year).keys()
        let year = year_keys.sort(d3.ascending)
        console.log(year_keys.sort(d3.ascending))

        bb = [-101, 35];



        let circ = svg.selectAll("circle")
            .data(temp)
            .enter()
            .append("circle")
            .attr("cx", function(d) {
                //console.log(parseFloat(d.Longitude))
                return projection([+d.Longitude, +d.Latitude])[0]
            })
            .attr("cy", d => projection([+d.Longitude, +d.Latitude])[1])
            .attr("r", d => d.temp_anom)
            .attr("fill", "red")
            .style("opacity", 0)


        var select = svg.append("foreignObject")
            .attr("x", 800)
            .attr("y", 35)
            .attr("width", 100)
            .attr("height", 100)
            .append("xhtml:body")
            .append("div")
            .html("<button>Click Me</button>")
            .on("click", change)

        function change() {
            svg
                .selectAll("circle")
                .data(temp)
                .transition()
                .delay(100)
                .duration(10000)
                .attr("cx", function(d) {
                    //console.log(parseFloat(d.Longitude))
                    return projection([+d.Longitude, +d.Latitude])[0]
                })
                .attr("cy", d => projection([+d.Longitude, +d.Latitude])[1])
                .attr("r", d => d.temp_anom * 8)
                .style("opacity", 0.5)


        }
        /* var sampleData = d3.range(1000).map(function(d) {
            var datapoint = {};
            datapoint.id = "Sample Feature " + d;
            datapoint.type = "Feature";
            datapoint.properties = {};
            datapoint.geometry = {};
            datapoint.geometry.type = "Polygon";
            datapoint.geometry.coordinates = randomCoords();
            return datapoint;
        });

        function randomCoords() {
            var randX = (Math.random() * 350) - 175;
            var randY = (Math.random() * 170) - 85;
            return [
                [
                    [randX - 5, randY],
                    [randX, randY - 5],
                    [randX - 10, randY - 5],
                    [randX - 5, randY]
                ]
            ];
        };*/





        /*  var x = d3.scaleLinear().range([0, 500]);
          var y = d3.scaleLinear().range([500, 0]);

          x.domain([0, 50]);
          y.domain([0, 50]);


          var poly = [{
              "x": 10,
              "y": 50
          }, {
              "x": 20,
              "y": 20
          }, {
              "x": 50,
              "y": 10
          }, {
              "x": 30,
              "y": 30
          }];


          svg.selectAll("polygon")
              .data([poly])
              .enter().append("polygon")
              .attr("points", function(d) {
                  return d.map(function(d) {
                      return [x(d.x), y(d.y)].join(",");
                  }).join(" ");
              });*/



    }
</script>

</html>
